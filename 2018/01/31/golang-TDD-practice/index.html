<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;elitegoblin.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="Preface    如果我们每天的工作就是喝着咖啡，嚼着零食，惬意的写写代码，按时回家。对写好的代码充满信心，不需要时刻担心自己的代码线上是否会出问题，不担心局部小小改动会以意想不到的方式引起故障；让别人一提起你都会说：这家伙的代码，No Problem。相信会让我们的人生幸福指数提高不少，然而现实情况却not even close，让人苦恼。TDD(Test Driven Developmen">
<meta property="og:type" content="article">
<meta property="og:title" content="golang TDD实践">
<meta property="og:url" content="https://elitegoblin.github.io/2018/01/31/golang-TDD-practice/index.html">
<meta property="og:site_name" content="Frank Sun&#39;s Tech Blog">
<meta property="og:description" content="Preface    如果我们每天的工作就是喝着咖啡，嚼着零食，惬意的写写代码，按时回家。对写好的代码充满信心，不需要时刻担心自己的代码线上是否会出问题，不担心局部小小改动会以意想不到的方式引起故障；让别人一提起你都会说：这家伙的代码，No Problem。相信会让我们的人生幸福指数提高不少，然而现实情况却not even close，让人苦恼。TDD(Test Driven Developmen">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-01-31T11:27:06.000Z">
<meta property="article:modified_time" content="2021-05-02T06:09:52.273Z">
<meta property="article:author" content="eliteGoblin">
<meta property="article:tag" content="golang">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="TDD">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://elitegoblin.github.io/2018/01/31/golang-TDD-practice/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;elitegoblin.github.io&#x2F;2018&#x2F;01&#x2F;31&#x2F;golang-TDD-practice&#x2F;&quot;,&quot;path&quot;:&quot;2018&#x2F;01&#x2F;31&#x2F;golang-TDD-practice&#x2F;&quot;,&quot;title&quot;:&quot;golang TDD实践&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>golang TDD实践 | Frank Sun's Tech Blog</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Frank Sun's Tech Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Preface"><span class="nav-number">1.</span> <span class="nav-text">Preface</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TDD-%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">TDD 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TDD%E4%B8%89%E5%AE%9A%E5%BE%8B"><span class="nav-number">2.1.</span> <span class="nav-text">TDD三定律</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TDD%E5%B7%A5%E4%BD%9C%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.2.</span> <span class="nav-text">TDD工作循环</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TDD-%E6%80%BB%E7%BB%93"><span class="nav-number">2.3.</span> <span class="nav-text">TDD 总结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#golang%E5%8E%9F%E7%94%9Ftesting%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">golang原生testing框架</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#testing%E6%A1%86%E6%9E%B6%E8%A6%81%E7%82%B9"><span class="nav-number">3.1.</span> <span class="nav-text">testing框架要点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">3.2.</span> <span class="nav-text">单元测试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Benchmark"><span class="nav-number">3.3.</span> <span class="nav-text">Benchmark</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Solving-Real-World-Problem"><span class="nav-number">4.</span> <span class="nav-text">Solving Real World Problem</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8TDD%E8%A7%A3%E5%86%B3leetcode-22-generate-parentheses"><span class="nav-number">4.1.</span> <span class="nav-text">用TDD解决leetcode　22: generate parentheses</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8benchmark%E8%A7%A3%E5%86%B3%E6%80%A7%E8%83%BD%E4%BA%89%E8%AE%BA"><span class="nav-number">4.2.</span> <span class="nav-text">用benchmark解决性能争论</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cool-Stuff"><span class="nav-number">5.</span> <span class="nav-text">Cool Stuff</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#tesing%E7%9A%84example%E6%9E%84%E5%BB%BA%E5%8A%A8%E6%80%81%E6%96%87%E6%A1%A3"><span class="nav-number">5.1.</span> <span class="nav-text">tesing的example构建动态文档</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81coverage"><span class="nav-number">5.2.</span> <span class="nav-text">代码coverage</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#go-report"><span class="nav-number">5.3.</span> <span class="nav-text">go report</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-number">6.</span> <span class="nav-text">结论</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-number">7.</span> <span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#leetcode-22-ACed-code"><span class="nav-number">7.1.</span> <span class="nav-text">leetcode 22 ACed code </span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#leetcode_22"><span class="nav-number">7.1.1.</span> <span class="nav-text"></span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#benchmark-%E4%BB%A3%E7%A0%81"><span class="nav-number">7.2.</span> <span class="nav-text">benchmark 代码     </span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#benchmark_code"><span class="nav-number">7.2.1.</span> <span class="nav-text"></span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reference"><span class="nav-number">8.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">eliteGoblin</p>
  <div class="site-description" itemprop="description">拒绝复制,经过思考后的总结才属于自己</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/eliteGoblin" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;eliteGoblin" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://elitegoblin.github.io/2018/01/31/golang-TDD-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eliteGoblin">
      <meta itemprop="description" content="拒绝复制,经过思考后的总结才属于自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Frank Sun's Tech Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          golang TDD实践
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-01-31 19:27:06" itemprop="dateCreated datePublished" datetime="2018-01-31T19:27:06+08:00">2018-01-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 14:09:52" itemprop="dateModified" datetime="2021-05-02T14:09:52+08:00">2021-05-02</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h4 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h4><div align="center">

</div>

<p>如果我们每天的工作就是喝着咖啡，嚼着零食，惬意的写写代码，按时回家。对写好的代码充满信心，不需要时刻担心自己的代码线上是否会出问题，不担心局部小小改动会以意想不到的方式引起故障；让别人一提起你都会说：这家伙的代码，No Problem。相信会让我们的人生幸福指数提高不少，然而现实情况却not even close，让人苦恼。<br>TDD(Test Driven Development)在实践中被证明是一种很有效的软件设计/开发方法，它不一定会让我们的梦想全部成真，但起码，带来了希望。</p>
<p>本文是作者在golang中学习TDD方法的一个总结：首先概括了TDD要素，然后讨论如何用基于golang的testing框架实现基本的TDD，并给出了例子：如何在解决leetcode问题时应用TDD</p>
<span id="more"></span>

<h4 id="TDD-简介"><a href="#TDD-简介" class="headerlink" title="TDD 简介"></a>TDD 简介</h4><h5 id="TDD三定律"><a href="#TDD三定律" class="headerlink" title="TDD三定律"></a>TDD三定律</h5><p>采用TDD方法开发软件的流程很有特色，:</p>
<ol>
<li> 在编写不能通过的单元测试前，不能编写生产代码</li>
<li> 只编写刚好无法通过的单元测试，不能编译也算不通过</li>
<li> 只编写刚好能通过当前失败case的生产代码</li>
</ol>
<h5 id="TDD工作循环"><a href="#TDD工作循环" class="headerlink" title="TDD工作循环"></a>TDD工作循环</h5><p>我们的写代码过程其实就是一次次的小循环，测试代码每次只比生产代码早写数分钟. 比如我们需要写一个模块: MakePizza(),对应三定律的具体开发步骤是</p>
<ol>
<li>　先写单元测试代码<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMakePizza</span><span class="params">()</span></span> &#123;</span><br><span class="line">    TestGetOven()</span><br><span class="line">    TestMakeDough()</span><br><span class="line">    TestPreparePizza()</span><br><span class="line">    TestBake()</span><br><span class="line">    TestGetPizza()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
这时测试是FAIL的，因为没有生产代码，编译不通过  </li>
<li>　修改代码使单元测试刚好能PASS，需要补其单元测试代码需要的生产代码的各个函数<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TestGetOven 需要</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetOven</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> getOven() != <span class="literal">true</span> &#123;</span><br><span class="line">        Error()...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getOven</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
为使得测试刚好通过，我们需要根据此test case写一些能让测试成功的临时代码</li>
<li> 审视代码，是否有重复，是否高内聚，低耦合；重构之，跳到１</li>
</ol>
<h5 id="TDD-总结"><a href="#TDD-总结" class="headerlink" title="TDD 总结"></a>TDD 总结</h5><ul>
<li> If it’s worth building, it’s worth testing</li>
<li> TDD本质是design activity：如何写出可测试的代码，一般就意味着高内聚低耦合</li>
<li> TDD顺带的好处便是验证代码(单元测试)和丰富的文档（独立的test case可以被认为是模块使用说明）</li>
<li> 在TDD过程中形成的测试集合可作为模块的requirement和specification，可作为其重要组成部分，但不可能代替全部文档</li>
<li> 每次一小步：一点单元测试代码，一点代码，在不断迭代中构建强壮的系统</li>
<li> 不追求完美，依照对系统的重要程度设计测试代码</li>
<li> TDD长于细微之处的说明和验证，不擅长处理类似整体设计的大问题，后者一般要配合AMDD方法，即agile model-driven development</li>
<li> Test Cases应由开发人员像维护生产代码一样维护，使之尽可能保持整洁，消灭重复</li>
</ul>
<h4 id="golang原生testing框架"><a href="#golang原生testing框架" class="headerlink" title="golang原生testing框架"></a>golang原生testing框架</h4><h5 id="testing框架要点"><a href="#testing框架要点" class="headerlink" title="testing框架要点"></a>testing框架要点</h5><p>Golang内部集成了轻量级的测试框架，要点如下</p>
<ul>
<li> 测试代码写在与生产代码一个package内(即同一folder下)，以 <strong>xxx_test.go</strong> 命名</li>
<li> 测试代码需要 import “testing”，包含两个基础功能测试和benchmark</li>
<li> 在package 执行 go test 即可自动执行此包下的所有测试</li>
</ul>
<h5 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h5><ul>
<li>功能测试: 核心对象是 testing.T，单元测试以函数为基本单元，go test其实实在挨个执行写好的单元测试函数<ul>
<li>单元函数命名必须为　TestXxx(t *testing.T)，Test后必须接一个大写字母<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMakePizza</span><span class="params">(t *testing.T)</span></span> &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Testgetoven</span><span class="params">(t *testing.T)</span></span> &#123;...&#125;   <span class="comment">// 不会执行，应为TestGetOven</span></span><br></pre></td></tr></table></figure></li>
<li>用testing.T的Error和Fail系列方法指示失败<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetOven</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> oven, err := getOven(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        t.Errorf(<span class="string">&quot;err %s&quot;</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>进行table-driven test:<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> testCases = []<span class="keyword">struct</span> &#123;</span><br><span class="line">    param1 <span class="keyword">string</span></span><br><span class="line">    param2 <span class="keyword">string</span></span><br><span class="line">    out <span class="keyword">string</span></span><br><span class="line">&#125; &#123;</span><br><span class="line">    &#123;<span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;out1&quot;</span>&#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAllCases</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> e := <span class="keyword">range</span> testCases &#123;</span><br><span class="line">        <span class="keyword">if</span> e.out != myFunc(e.param1, e,param2) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>如何精确指定运行的测试case?  <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> test -run NameOfTest <span class="comment">// 精确指定case name pattern</span></span><br><span class="line"><span class="keyword">go</span> test xxx_test.<span class="keyword">go</span>     <span class="comment">// 运行xxx_test.go的所有测试case</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h5><p>Benchmark 核心对象是testing.B，以函数为基本运行单元</p>
<ul>
<li> 函数声名：BenchmarkXxx(*testing.B)</li>
<li> 运行方式：go test -bench benchFuncName：　benchFuncName可以是regexp</li>
<li>bench一般格式    <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkHello</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        fmt.Sprintf(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 执行原理：go会重复执行BenchmarkHello b.N次，b.N会根据运行时测试情况调整</li>
<li> RunParallel 来同时运行多个function, 需用 go test -cpu cpu_num来运行<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkTemplateParallel</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    b.RunParallel(<span class="function"><span class="keyword">func</span><span class="params">(pb *testing.PB)</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> pb.Next() &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li> 如果Benchmark函数执行需要一个耗时的环境setup函数，此时我们并不像让其计入我们的平均耗时，可以这样：<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkBigLen</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    big := NewBig()</span><br><span class="line">    b.ResetTimer()   <span class="comment">// 执行完setup后，reset benchmark的timer</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        big.Len()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Solving-Real-World-Problem"><a href="#Solving-Real-World-Problem" class="headerlink" title="Solving Real World Problem"></a>Solving Real World Problem</h4><h5 id="用TDD解决leetcode-22-generate-parentheses"><a href="#用TDD解决leetcode-22-generate-parentheses" class="headerlink" title="用TDD解决leetcode　22: generate parentheses"></a>用TDD解决leetcode　22: generate parentheses</h5><blockquote>
<p>Given n pairs of parentheses, write a function to generate all combinations of well-formed parentheses.<br>For example, given n = 3, a solution set is:<br>[<br>  “((()))”,<br>  “(()())”,<br>  “(())()”,<br>  “()(())”,<br>  “()()()”<br>]</p>
</blockquote>
<ul>
<li>首先我们根据题目要求，先写出单元测试函数  <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGenerateParenthesis_0</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    res := generateParenthesis(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> res == <span class="literal">nil</span> || <span class="built_in">len</span>(res) != <span class="number">0</span> ||  &#123;</span><br><span class="line">        t.Errorf(<span class="string">&quot;expected empty, got %v&quot;</span>, res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  我们首先想到测试n == 0情况，预期返回空数组；可见使用了TDD，我们会强制自己在写代码前，考虑极端case</li>
<li>修改生产代码，使之PASS  <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateParenthesis</span><span class="params">(n <span class="keyword">int</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> == n &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>查看生产代码：有无可重构之处，有无重复；开始下一个循环，写更多的单元测试，归纳出2个case，用table-driven方式写出：  <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class="line"><span class="keyword">var</span> testCases = []<span class="keyword">struct</span> &#123;</span><br><span class="line">    in <span class="keyword">int</span></span><br><span class="line">    out []<span class="keyword">string</span></span><br><span class="line">&#125; &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;()&quot;</span>&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        []<span class="keyword">string</span>&#123;</span><br><span class="line">            <span class="string">&quot;((()))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;(()())&quot;</span>,</span><br><span class="line">            <span class="string">&quot;(())()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;()(())&quot;</span>,</span><br><span class="line">            <span class="string">&quot;()()()&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGenerateParenthesis</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> testing.Short() &#123; <span class="comment">// 如果指定 go test -short ，则为short模式，此函数会被跳过</span></span><br><span class="line">        t.Skip()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> _, test := <span class="keyword">range</span> testCases &#123;</span><br><span class="line">            res := generateParenthesis(test.in)</span><br><span class="line">            <span class="comment">// 第三方assert package，提供了方便的assert函数</span></span><br><span class="line">            assert.Equal(t, <span class="built_in">len</span>(test.out), <span class="built_in">len</span>(res), <span class="string">&quot;array size should be same: expected %v, got %v&quot;</span>,</span><br><span class="line">                test.out, res)</span><br><span class="line">            aIsSubsetOfB(t, res, test.out) <span class="comment">// 自己根据assert package封装，判断两集合是否有子集关系</span></span><br><span class="line">            aIsSubsetOfB(t, test.out, res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>补齐能通过TestGenerateParenthesis函数的代码，我们很有信心能一次AC，最终代码可以在本文最后<a href="#leetcode_22">附录</a>找到</p>
<h5 id="用benchmark解决性能争论"><a href="#用benchmark解决性能争论" class="headerlink" title="用benchmark解决性能争论"></a>用benchmark解决性能争论</h5><p>我们在实际工作中遇到一个小疑惑：我们需要在运行时从别处取值来填充内存的map,需要先clear map，有两种方式：  </p>
<p>删除此前map的所有key，或者重新new一个map<br>两者运行时性能孰优孰劣呢？用benchmark一目了然:</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkStatic</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i ++ &#123;</span><br><span class="line">        <span class="keyword">for</span> k := <span class="keyword">range</span> mp &#123; <span class="comment">// 用删除key的方式clear map</span></span><br><span class="line">            <span class="built_in">delete</span>(mp, k)</span><br><span class="line">        &#125;</span><br><span class="line">        getSevenRand()  <span class="comment">// 取得7个随机数</span></span><br><span class="line">        fillMpContent() <span class="comment">// 填充此map</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDynamic</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i ++ &#123;</span><br><span class="line">        mp = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>) <span class="comment">// new map</span></span><br><span class="line">        getSevenRand()</span><br><span class="line">        fillMpContent()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>benchmark结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkStatic-4        3000000               576 ns&#x2F;op</span><br><span class="line">BenchmarkDynamic-4       2000000               824 ns&#x2F;op</span><br></pre></td></tr></table></figure>

<p>可见在运行时频繁创建map会耗时较高,完整的benchmark代码也可以在<a href="#benchmark_code">附录</a>中找到</p>
<h4 id="Cool-Stuff"><a href="#Cool-Stuff" class="headerlink" title="Cool Stuff"></a>Cool Stuff</h4><p>笔者非常喜欢Golang的一大原因便是其提供了一系列非常实用且handy的工具集，make your everyday programming life a lot easier</p>
<h5 id="tesing的example构建动态文档"><a href="#tesing的example构建动态文档" class="headerlink" title="tesing的example构建动态文档"></a>tesing的example构建动态文档</h5><p>之前提到TDD的一个side effect便是产生出了＂动态＂的文档，这个特殊的文档好处便是不会过时．<br>Golang对此提供了方便的example功能，类似test单元函数，但其目的更明确：是文档的一部分，而且可以用godoc工具方便的把example代码嵌入到网页文档中，比如官方string包的<a target="_blank" rel="noopener" href="https://golang.org/pkg/strings/#pkg-examples">example</a>，可以直接在网页文档上点运行，直接能看运行结果，非常方便，以下是要点：</p>
<ul>
<li> 类似test，example对应golang的函数，在go test被运行且被验证</li>
<li>example函数命名：ExampleXXX()，<ul>
<li> example of a package:    Example()</li>
<li> function F :             ExampleF()</li>
<li> a type T :               ExampleT()</li>
<li> method M on type T:      ExampleT_M()</li>
<li> 多个example用 ExampleXXX_suffix()</li>
</ul>
</li>
<li> 需要在函数结尾以注释中用Output关键字指明expected output,不含output的example code不会被执行，但是会编译</li>
<li>Output写法:<ul>
<li>匹配特定顺序输出:  <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleSalutations</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;hello, and&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;goodbye&quot;</span>)</span><br><span class="line">    <span class="comment">// Output:</span></span><br><span class="line">    <span class="comment">// hello, and</span></span><br><span class="line">    <span class="comment">// goodbye</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>匹配unordered的输出: Unordered output  <figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExamplePerm</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> Perm(２) &#123;</span><br><span class="line">        fmt.Println(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Unordered output:</span></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="代码coverage"><a href="#代码coverage" class="headerlink" title="代码coverage"></a>代码coverage</h5><p>测试代码coverage能看出大体的测试覆盖情况,在go里可以用很容易的获取</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go test -cover                     // package整体测试覆盖率</span><br><span class="line">go test -coverprofile=coverage.out // 输出测试统计</span><br><span class="line">go tool cover -func=coverage.out   // 函数级别的测试覆盖率</span><br><span class="line">go tool cover -html=coverage.out   // 网页形式生成覆盖率报告</span><br></pre></td></tr></table></figure>

<p>网页形式coverage report见下图，可见，Golang除了给出整体的覆盖率，还给出了未被测试代码覆盖的生产代码行</p>


<h5 id="go-report"><a href="#go-report" class="headerlink" title="go report"></a>go report</h5><p>如果有一个工具能直观的看到我们代码的各项指标如fmt, lint, function complexity等，其实就能对代码的质量的出一个大致的了解: </p>


<p>上图是用一个在线工具<a target="_blank" rel="noopener" href="https://goreportcard.com/">goreportcard</a>生成的，其代码在github可以找到: <a target="_blank" rel="noopener" href="https://github.com/gojp/goreportcard">goreportcard project</a></p>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>本文从TDD概述开始，介绍了TDD的基本工作方法和意义；本着用Golang实践TDD的目的，介绍了testing框架，并以解决1个leetcode问题的契机展示了如何用TDD方式进行开发．在最后列举了一些有意思的特性和工具.希望对有兴趣了解TDD的朋友一些启发，欢迎讨论及指教．</p>
<h4 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h4><h5 id="leetcode-22-ACed-code"><a href="#leetcode-22-ACed-code" class="headerlink" title="leetcode 22 ACed code "></a>leetcode 22 ACed code <h6 id="leetcode_22"></h6></h5><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateParenthesis</span><span class="params">(n <span class="keyword">int</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">    allValidStrings = <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">    walkGenerateTreeRecusive(<span class="string">&quot;&quot;</span>, n, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> allValidStrings</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allValidStrings []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walkGenerateTreeRecusive</span><span class="params">(curString <span class="keyword">string</span>, total <span class="keyword">int</span>, leftParenthesisCt <span class="keyword">int</span>, rightParenthesisCt <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> total &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        allValidStrings = []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> leftParenthesisCt == total &#123;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; total - rightParenthesisCt; i ++ &#123;</span><br><span class="line">            curString +=  <span class="keyword">string</span>(<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        allValidStrings = <span class="built_in">append</span>(allValidStrings, curString)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        walkGenerateTreeRecusive(curString + <span class="keyword">string</span>(<span class="string">&#x27;(&#x27;</span>), total, leftParenthesisCt + <span class="number">1</span>, rightParenthesisCt)</span><br><span class="line">        <span class="keyword">if</span> leftParenthesisCt &gt; rightParenthesisCt &#123;</span><br><span class="line">            walkGenerateTreeRecusive(curString + <span class="keyword">string</span>(<span class="string">&#x27;)&#x27;</span>), total, leftParenthesisCt, rightParenthesisCt + <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="benchmark-代码"><a href="#benchmark-代码" class="headerlink" title="benchmark 代码     "></a>benchmark 代码     <h6 id="benchmark_code"></h6></h5><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> _16_combination_sum_III</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    MAXRAND = <span class="number">100000</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr []<span class="keyword">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    arr = <span class="built_in">make</span>([]<span class="keyword">int</span>, MAXRAND, MAXRAND)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(arr); i ++ &#123;</span><br><span class="line">        arr[i] = rand.Int()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mp = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)</span><br><span class="line"><span class="keyword">var</span> randIndex = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mpContent [<span class="number">7</span>]<span class="keyword">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSevenRand</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> MAXRAND - randIndex &lt; <span class="number">7</span> &#123;</span><br><span class="line">        randIndex = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">7</span>; i ++ &#123;</span><br><span class="line">        mpContent[i] =  randIndex + i</span><br><span class="line">    &#125;</span><br><span class="line">    randIndex = randIndex + <span class="number">7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fillMpContent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">7</span>; i ++ &#123;</span><br><span class="line">        mp[mpContent[i]] = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkStatic</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i ++ &#123;</span><br><span class="line">        <span class="keyword">for</span> k := <span class="keyword">range</span> mp &#123;</span><br><span class="line">            <span class="built_in">delete</span>(mp, k)</span><br><span class="line">        &#125;</span><br><span class="line">        getSevenRand()</span><br><span class="line">        fillMpContent()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDynamic</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i ++ &#123;</span><br><span class="line">        mp = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)</span><br><span class="line">        getSevenRand()</span><br><span class="line">        fillMpContent()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p>TDD:<br><em>Clean Code</em> Robert C. Martin Chapter 9 单元测试<br><a target="_blank" rel="noopener" href="http://agiledata.org/essays/tdd.html">Introduction to Test Driven Development</a><br><a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/TestDrivenDevelopment.html">TestDrivenDevelopment</a><br><a target="_blank" rel="noopener" href="http://www.jamesshore.com/Agile-Book/test_driven_development.html">The Art of Agile Development: Test-Driven Development</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/797026/test-driven-development-book">Test driven development book [closed]</a>  </p>
<p>Golang Testing:<br><a target="_blank" rel="noopener" href="https://blog.alexellis.io/golang-writing-unit-tests/">Golang basics - writing unit tests</a><br><a target="_blank" rel="noopener" href="https://blog.golang.org/examples">Testable Examples in Go</a><br><a target="_blank" rel="noopener" href="https://leanpub.com/golang-tdd/read#leanpub-auto-wrapping-up-2">Test-driven development with Go</a><br><a target="_blank" rel="noopener" href="https://github.com/stretchr/testify#installation">testify package</a><br><a target="_blank" rel="noopener" href="https://github.com/gojp/goreportcard">goreportcard</a><br><a target="_blank" rel="noopener" href="http://openmymind.net/Dependency-Injection-In-Go/">“Dependency Injection” in Golang</a><br><a target="_blank" rel="noopener" href="https://blog.golang.org/cover">The cover story</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/16935965/how-to-run-test-cases-in-a-specified-file">How to run test cases in a specified file?</a>  </p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/golang/" rel="tag"># golang</a>
              <a href="/tags/testing/" rel="tag"># testing</a>
              <a href="/tags/TDD/" rel="tag"># TDD</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/10/19/Introduce-URL-Encode/" rel="prev" title="漫谈Url Encode">
                  <i class="fa fa-chevron-left"></i> 漫谈Url Encode
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/02/23/Solve-too-many-open-files-issue/" rel="next" title="由Too many open files问题看system limit">
                  由Too many open files问题看system limit <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">eliteGoblin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
